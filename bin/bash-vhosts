#!/usr/local/bin/bash

newProject() {
  # grab data
  echo "Repo"
  read GIT
  echo "Project root dir (relative to $PWD)"
  read ROOTDIR
  echo "Public root dir (relative to $PWD/$ROOTDIR)"
  read PUBLICDIR


  # config vhost
  VHOST_PTN="
<VirtualHost $ROOTDIR.dev:80>
    ServerName $ROOTDIR.dev
    DocumentRoot \"$PWD/$ROOTDIR/$PUBLICDIR\"
    <Directory \"$PWD/$ROOTDIR/$PUBLICDIR\">
        Options FollowSymLinks Multiviews
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
"

  # config hosts entry
  HOSTS_PTN="127.0.0.1       $ROOTDIR.dev"


  # clone repo
  cd ~/localserver
  git clone $GIT $ROOTDIR
  cd ~/$ROOTDIR

  # add vhost and hosts entries
  echo $VHOST_PTN >> /usr/local/etc/apache2/extra/httpd-vhosts.conf
  echo $HOSTS_PTN >> /etc/hosts

  # restart apache
  echo "Restarting apache..."
  sudo apachectl restart

  # create database
  echo "Creating database"
  mysql -uroot -p -e "create database $ROOTDIR;"

  # open in browser and sublime
  open "http://$ROOTDIR.dev/"
}
