#!/bin/bash
# ######## #
# Vhosting #
# ######## #
newProject() {
  DEFAULT_PORT="80"

  # grab data
  echo "Repo"
  read GIT
  echo "Project root dir (relative to $PWD)"
  read ROOTDIR
  echo "Public root dir (relative to $PWD/$ROOTDIR)"
  read PUBLICDIR
  echo "TLD (e.g. [app|dev])"
  read TLD
  echo "DB name"
  read DBNAME

  # config vhost
  VHOST_PTN="
<VirtualHost $ROOTDIR.$TLD:80>
    ServerName $ROOTDIR.$TLD
    DocumentRoot \"$PWD/$ROOTDIR/$PUBLICDIR\"
    <Directory \"$PWD/$ROOTDIR/$PUBLICDIR\">
        Options FollowSymLinks Multiviews
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
"

  # config hosts entry
  HOSTS_PTN="127.0.0.1       $ROOTDIR.$TLD"


  # clone repo
  cd ~/localserver
  git clone $GIT $ROOTDIR

  # add vhost and hosts entries
  echo $VHOST_PTN >> /usr/local/etc/apache2/extra/httpd-vhosts.conf
  echo $HOSTS_PTN >> /etc/hosts

  # restart apache
  echo "Restarting apache..."
  sudo apachectl restart

  # create database
  echo "Creating database"
  mysql -uroot -p -e "create database $DBNAME;"

  # open in browser and sublime
  open "http://$ROOTDIR.$TLD/"
  subl "$PWD/$ROOTDIR"
}
