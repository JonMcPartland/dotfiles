#!/usr/local/bin/bash
# ######### #
# Messaging #
# ######### #
# message +447123456789 "Hello world" or
# message "jon" "Hello world", if jon is a contact alias
message() {
    local isNumber=$(echo $1 | grep '\+[0-9]*' | sed 's/,//g')
    local contact=${CONTACT[$1]}
    local message=$(echo $2 | sed -e 's/\"/\\\"/g')
    local recipient=""

    if [[ $contact != "" ]]; then
        recipient="$contact"
    elif [[ $isNumber != "" ]]; then
        recipient="$1"
    fi

    if [[ $recipient != "" ]]; then
        echo 'tell application "Messages" to send "'$message'" to buddy "'$recipient'" of first item of (services whose service type is iMessage)' | osascript && echo "Message sending";
    else
        echo "$1 is not set as a contact. Please use their international number, or add them as a contact:"
        echo "contact add \"foo\" \"+447123456789\""
    fi
}
